#Obsidian/プラグイン自作 
## プラグイン概要
`zh-cn` コードブロック内に書かれた中国語(簡体字) の文の上に、ルビとしてピンインを表示するプラグイン

ピンインは、コードブロック上にマウスホバーしているときにだけ表示されるようにする

## 現状
- `pinyin-pro` ライブラリを利用して、文中の各漢字に対するピンインを取得する
- 漢字1文字に対して1つの縦向き inline-flex 要素を用意して、内部でピンインと漢字を上下に並べる
	- ピンイン部分に関しては `user-select: none`
- ↑を横向き flexbox (`flex-wrap: nowrap`) で並べる
## 問題
プレビュー時に複数の漢字を範囲選択してコピーすると、１文字ごとに半角スペースが挟まった文字列がコピーされてしまっている
## 代替案
- DOMツリーに追加されていない不可視の canvas 要素を用意して、そのなかでピンイン＋漢字のペアそれぞれの横幅を計測する (`measureText`)
- コードブロック全体の横幅を取得と↑の各ペアの横幅をもとに、各行に何文字ずつ左から敷き詰められるか計算する
- ピンインを表示するためのレーンと、漢字を表示するためのレーンを完全に分け、それぞれ単なるインライン要素として `line-height` プロパティを駆使して大きく行間を開け、位置をズラして重ねることで、ピンインのレーンと漢字のレーンが交互に表示されているように見せかける
	- ピンインのレーンは `user-select: none`
- ↑のどちらのレーンでも `span` タグ、 `padding` プロパティを駆使して字間を調整することで、ペアごとの見た目を整え、かつ漢字レーンに対する文字選択・コピー時に半角スペースが勝手に挿入されないようにする
