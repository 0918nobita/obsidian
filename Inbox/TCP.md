#技術
Transmission Control Protocol
送信を制御する取り決め

ベストエフォート型の IP を使って、信頼性のあるストリーム型の通信サービスをプログラマに提供する

ソケットプログラミングでは TCP は `SOCK_STREAM` と定義される
TCP では送信データが１バイト単位で順番に届くことを保証するが、バイトの切れ目がわからなくなっており、これをストリーム型と呼んでいる

IP が「失敗する可能性があってもとにかく宛先にデータを届ける」ことに専念するのに対して、TCP は IP を用いて「すべてのデータが順序通りに正しく届くように制御する」ことを担う

プログラマは TCP のおかげでアプリケーションの動作環境に細かい注意を払わずともそれなりの性能で通信するプログラムを組むことができる

TCP の利用例：
- HTTP/1, HTTP/2：Web における通信
	- インターネットを介して大量のデータを送る必要があり、輻輳制御が必要なため
- SMTP：電子メールの送信
- IMAP4：電子メールの受信
- SSH：暗号化した遠隔ログイン

TCP は、アプリケーション間で双方向通信が可能となる仮想的なコネクションを確立し、信頼性を提供する (ユニキャスト, 1対1通信)
**コネクションは通信するホスト同士で管理し、中継するルーター等は関与しない**

データを送るだけでなく、受け取ったら ACK (ACKnowledgement; 確認応答) と呼ばれる情報を送り出して、届いたことを知らせる
送信側は、一定時間内に ACK が来なかった場合に「パケットが喪失した」と判断してパケットを再送する
これらの処理がアプリケーションから見えないところで自動的に行われる

TCP はバッファを用いて送受信データを管理している
アプリが送信命令を実行した場合、そのデータを一旦バッファに溜め、それを送っていいかどうかを判断する
データをバッファから削除するのは、そのデータが到着したことを確認できた後

データを送信するには条件がある
- コネクションが確立されていること
- 小さなデータパケットを連続して送ることにならないか (Nagle アルゴリズム)
- 受信側のバッファに空きがあるか (フロー制御)
- ネットワークの混み具合は深刻ではないか (輻輳制御)

条件を満たしていない場合、データの送信処理を先送りにする

**アプリの動作とは関係なく、TCP は以下の条件でパケットを送信する**
- データが届いたけれど、しばらく ACK を送っていなかった (遅延 ACK)
- 送ったデータに対する ACK がなかなか返ってこない (再送制御)
- いっぱいだった受信バッファに空きができた (ウィンドウアップデート)
- 相手から「受信バッファの空きがない」通知が来ていたが、そろそろ空きができたのではないか？と尋ねる (ウィンドウプローブ)

受信側が受信命令を実行した場合、実際に受信できるのは抜けがなく届いている部分だけ
TCP には順序制御があるため、途中で抜けている場合には、その先がすでに届いていたとしてもアプリケーションには渡さない
※「途中が抜けていたとしても再送を待たずに届いているものを先に処理したい」場合には UDP を用いる
